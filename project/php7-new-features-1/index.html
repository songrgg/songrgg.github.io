<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> PHP7特性概览(一) · Songrgg's Blog</title><meta name="description" content="PHP7特性概览(一) - songrgg"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://songrgg.github.io/atom.xml" title="Songrgg's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/songrgg" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">PHP7特性概览(一)</h1><div class="post-info">Jul 23, 2015</div><div class="post-content"><p>了解PHP7的一些特性，搭建PHP7源码编译环境，并运行官网这些新特性的代码。</p>
<hr>
<h3 id="在64位平台支持64位integer"><a href="#在64位平台支持64位integer" class="headerlink" title="在64位平台支持64位integer"></a>在64位平台支持64位integer</h3><p>在64位平台支持64位integer，长度为2^64-1字符串。</p>
<p><a href="https://wiki.php.net/rfc/size_t_and_int64_next" target="_blank" rel="noopener">更详细查看</a></p>
<h3 id="抽象语法树"><a href="#抽象语法树" class="headerlink" title="抽象语法树"></a>抽象语法树</h3><p>抽象语法树是语法分析之后产物，忽略了语法细节，是解释前端和后端的中间媒介。新增抽象语法树，解耦语法分析和编译，简化开发维护，并为以后新增一些特性，如添加抽象语法树编译hook，深入到语言级别实现功能。</p>
<p><a href="https://wiki.php.net/rfc/abstract_syntax_tree" target="_blank" rel="noopener">更详细查看</a></p>
<h3 id="闭包this绑定"><a href="#闭包this绑定" class="headerlink" title="闭包this绑定"></a>闭包this绑定</h3><p>新增<code>Closure::call</code>，优化<code>Closure::bindTo</code>(JavaScript中bind，apply也是一样的应用场景)。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123; <span class="keyword">private</span> $x = <span class="number">3</span>; &#125;</span><br><span class="line">$foo = <span class="keyword">new</span> Foo;</span><br><span class="line">$foobar = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123; var_dump(<span class="keyword">$this</span>-&gt;x); &#125;;</span><br><span class="line">$foobar-&gt;call($foo); <span class="comment">// prints int(3)</span></span><br></pre></td></tr></table></figure></p>
<p>2-3行新建Foo的对象，第4行创建了一个<code>foobar</code>的闭包，第5行调用闭包的<code>call</code>方法，将闭包体中的<code>$this</code>动态绑定到<code>$foo</code>并执行。</p>
<p>同时官网上进行性能测试，<code>Closure::call</code>的性能优于<code>Closure::bindTo</code>。</p>
<p><a href="https://wiki.php.net/rfc/closure_apply" target="_blank" rel="noopener">更详细查看Closure::call</a></p>
<h3 id="简化isset的语法糖"><a href="#简化isset的语法糖" class="headerlink" title="简化isset的语法糖"></a>简化isset的语法糖</h3><p>从使用者角度来说，比较贴心的一个语法糖，减少了不必要的重复代码，使用情景如：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// PHP 5.5.14</span></span><br><span class="line">$username = <span class="keyword">isset</span>($_GET[<span class="string">'username'</span>]) ? $_GET[<span class="string">'username'</span>] : <span class="string">'nobody'</span>;</span><br><span class="line"><span class="comment">// PHP 7</span></span><br><span class="line">$username = $_GET[<span class="string">'username'</span>] ?? <span class="string">'nobody'</span>;</span><br></pre></td></tr></table></figure></p>
<p>在服务器端想获取$_GET中的变量时，若是PHP5语法，需要使用<code>?:</code>操作符，每次要重写一遍<code>$_GET[&#39;username&#39;]</code>，而在PHP7就可以使用这个贴心的语法糖，省略这个重复的表达式。</p>
<p><a href="https://wiki.php.net/rfc/isset_ternary" target="_blank" rel="noopener">更详细查看isset_ternary</a></p>
<h3 id="yield-from"><a href="#yield-from" class="headerlink" title="yield from"></a>yield from</h3><p>允许<code>Generator</code>方法代理<code>Traversable</code>的对象和数组的操作。这个语法允许把<code>yield</code>语句分解成更小的概念单元，正如利用分解类方法简化面向对象代码。<br>例子：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">g1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">g2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span> from g1();</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">$g = g2();</span><br><span class="line"><span class="keyword">foreach</span> ($g <span class="keyword">as</span> $yielded) &#123;</span><br><span class="line">    <span class="keyword">print</span>($yielded);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line"><span class="comment">// 12345</span></span><br></pre></td></tr></table></figure></p>
<p><code>yield from</code>后能跟随<code>Generator</code>，<code>Array</code>，或<code>Traversable</code>的对象。</p>
<p><a href="https://wiki.php.net/rfc/generator-delegation" target="_blank" rel="noopener">更详细查看generator delegation</a></p>
<h3 id="匿名类"><a href="#匿名类" class="headerlink" title="匿名类"></a>匿名类</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line">$child = <span class="keyword">new</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Foo</span> </span>&#123;&#125;;</span><br><span class="line"> </span><br><span class="line">var_dump($child <span class="keyword">instanceof</span> Foo); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p><a href="https://wiki.php.net/rfc/anonymous_classes" target="_blank" rel="noopener">更详细查看anonymous class</a></p>
<h3 id="标量类型声明"><a href="#标量类型声明" class="headerlink" title="标量类型声明"></a>标量类型声明</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(int $a, int $b)</span>: <span class="title">int</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $a + $b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var_dump(add(<span class="number">1</span>, <span class="number">2</span>)); <span class="comment">// int(3)</span></span><br><span class="line"><span class="comment">// floats are truncated by default</span></span><br><span class="line">var_dump(add(<span class="number">1.5</span>, <span class="number">2.5</span>)); <span class="comment">// int(3)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//strings convert if there's a number part</span></span><br><span class="line">var_dump(add(<span class="string">"1"</span>, <span class="string">"2"</span>)); <span class="comment">// int(3)</span></span><br></pre></td></tr></table></figure>
<p><a href="https://wiki.php.net/rfc/scalar_type_hints_v5" target="_blank" rel="noopener">更详细查看</a></p>
<h3 id="返回值类型声明"><a href="#返回值类型声明" class="headerlink" title="返回值类型声明"></a>返回值类型声明</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_config</span><span class="params">()</span>: <span class="title">array</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line">var_dump(get_config());</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> &amp;<span class="title">get_arr</span><span class="params">(array &amp;$arr)</span>: <span class="title">array</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $arr;</span><br><span class="line">&#125;</span><br><span class="line">$arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">$arr1 = get_arr($arr);</span><br><span class="line">$arr[] = <span class="number">4</span>;</span><br><span class="line"><span class="comment">// $arr1[] = 4;</span></span><br><span class="line">var_dump($arr1 === $arr);</span><br></pre></td></tr></table></figure>
<p><a href="https://wiki.php.net/rfc/return_types" target="_blank" rel="noopener">更详细查看return_types</a></p>
<h3 id="3路比较"><a href="#3路比较" class="headerlink" title="3路比较"></a>3路比较</h3><p>一个语法糖，用来简化比较操作符，常应用于需要使用比较函数的排序，消除用户自己写比较函数可能出现的错误。分为3种情况，大于(1)，等于(0)，小于(-1)。<br><figure class="highlight php"><figcaption><span>%&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">order_func</span><span class="params">($a, $b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $a &lt;=&gt; $b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> order_func(<span class="number">2</span>, <span class="number">2</span>); <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">echo</span> order_func(<span class="number">3</span>, <span class="number">2</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">echo</span> order_func(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// -1</span></span><br></pre></td></tr></table></figure></p>
<h3 id="导入包的缩写"><a href="#导入包的缩写" class="headerlink" title="导入包的缩写"></a>导入包的缩写</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">import shorthand</span><br><span class="line">Current <span class="keyword">use</span> <span class="title">syntax</span>:</span><br><span class="line"> </span><br><span class="line"><span class="title">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Console</span>\<span class="title">Helper</span>\<span class="title">Table</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Console</span>\<span class="title">Input</span>\<span class="title">ArrayInput</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Console</span>\<span class="title">Output</span>\<span class="title">NullOutput</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Console</span>\<span class="title">Question</span>\<span class="title">Question</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Console</span>\<span class="title">Input</span>\<span class="title">InputInterface</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Console</span>\<span class="title">Output</span>\<span class="title">OutputInterface</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Console</span>\<span class="title">Question</span>\<span class="title">ChoiceQuestion</span> <span class="title">as</span> <span class="title">Choice</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Console</span>\<span class="title">Question</span>\<span class="title">ConfirmationQuestion</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Proposed group use syntax:</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Console</span>\&#123;</span><br><span class="line">  <span class="title">Helper</span>\<span class="title">Table</span>,</span><br><span class="line">  <span class="title">Input</span>\<span class="title">ArrayInput</span>,</span><br><span class="line">  <span class="title">Input</span>\<span class="title">InputInterface</span>,</span><br><span class="line">  <span class="title">Output</span>\<span class="title">NullOutput</span>,</span><br><span class="line">  <span class="title">Output</span>\<span class="title">OutputInterface</span>,</span><br><span class="line">  <span class="title">Question</span>\<span class="title">Question</span>,</span><br><span class="line">  <span class="title">Question</span>\<span class="title">ChoiceQuestion</span> <span class="title">as</span> <span class="title">Choice</span>,</span><br><span class="line">  <span class="title">Question</span>\<span class="title">ConfirmationQuestion</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><a href="https://wiki.php.net/rfc/group_use_declarations" target="_blank" rel="noopener">更详细查看</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/sourcecode/add-syntactic-feature-to-php7/" class="prev">PREV</a><a href="/project/yongwu-next-step/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'srjiang';
var disqus_identifier = 'project/php7-new-features-1/';
var disqus_title = 'PHP7特性概览(一)';
var disqus_url = 'https://songrgg.github.io/project/php7-new-features-1/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//srjiang.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2018 <a href="https://songrgg.github.io">songrgg</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>