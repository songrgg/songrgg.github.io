<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>My first Hackathon: bring Spinnaker to my company - Blog | Songrgg</title><meta description="I’ve joined my first Hackathon and worked on a project about using Spinnaker as CI&amp;#x2F;CD tool within company. The biggest challenge is to install Spinnaker on CentOS 7 with docker-compose. Why Spinnaker?"><meta property="og:type" content="article"><meta property="og:title" content="My first Hackathon: bring Spinnaker to my company"><meta property="og:url" content="https://songrgg.github.io/operation/hackathon-spinnaker/"><meta property="og:site_name" content="Blog | Songrgg"><meta property="og:description" content="I’ve joined my first Hackathon and worked on a project about using Spinnaker as CI&amp;#x2F;CD tool within company. The biggest challenge is to install Spinnaker on CentOS 7 with docker-compose. Why Spinnaker?"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://songrgg.github.io/images/spin-deployment-strategies.webp"><meta property="article:published_time" content="2019-09-11T21:11:50.000Z"><meta property="article:modified_time" content="2020-06-06T23:48:33.566Z"><meta property="article:author" content="songrgg"><meta property="article:tag" content="kubernetes"><meta property="article:tag" content="sre"><meta property="article:tag" content="cicd"><meta property="article:tag" content="spinnaker"><meta property="article:tag" content="docker-compose"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/images/spin-deployment-strategies.webp"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://songrgg.github.io/operation/hackathon-spinnaker/"},"headline":"Blog | Songrgg","image":[],"datePublished":"2019-09-11T21:11:50.000Z","dateModified":"2020-06-06T23:48:33.566Z","author":{"@type":"Person","name":"songrgg"},"description":"I’ve joined my first Hackathon and worked on a project about using Spinnaker as CI&#x2F;CD tool within company. The biggest challenge is to install Spinnaker on CentOS 7 with docker-compose. Why Spinnaker?"}</script><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><!--!--><script src="https://www.googletagmanager.com/gtag/js?id=UA-74431120-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-74431120-1');</script><!--!--><link rel="alternate" href="/atom.xml" title="Blog | Songrgg" type="application/atom+xml">
</head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">SongRong&#039;s Experience</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="thumbnail" src="/images/spin-deployment-strategies.webp" alt="My first Hackathon: bring Spinnaker to my company"></span></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-11T21:11:50.000Z" title="2019-09-11T21:11:50.000Z">2019-09-11</time><span class="level-item"><a class="link-muted" href="/categories/operation/">operation</a></span><span class="level-item">5 minutes read (About 806 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">My first Hackathon: bring Spinnaker to my company</h1><div class="content"><p>I’ve joined my first Hackathon and worked on a project about using <a href="https://www.spinnaker.io">Spinnaker</a> as CI/CD tool within company. The biggest challenge is to install Spinnaker on CentOS 7 with <a href="https://docs.docker.com/compose/">docker-compose</a>.</p>
<h2 id="Why-Spinnaker"><a href="#Why-Spinnaker" class="headerlink" title="Why Spinnaker?"></a>Why Spinnaker?</h2><ul>
<li>Spinnaker is dedicated to deploy services across multiple cloud providers and the integration with AWS, GCP, Azure is out of box.</li>
<li>It’s focused on deploy stably, support full control of workflow, developers can customize the deployment flow to improve the quality of deployment, also it’s automatic.</li>
<li>You will have a Web UI.</li>
</ul>
<a id="more"></a>

<h2 id="How-to-use-Spinnaker"><a href="#How-to-use-Spinnaker" class="headerlink" title="How to use Spinnaker?"></a>How to use Spinnaker?</h2><p>Spinnaker can integrate with VCS like Github, Gitlab, Gitbucket, docker registry.<br>For example the workflow of deploy golang github project to Kubernetes cluster.</p>
<ol>
<li>A developer pushes code to Github repository, it triggers the Travis-CI that starts the test, build, package stages, a docker image is pushed to Docker repository finally.</li>
<li>Spinnaker has a trigger on the Docker repository and starts to deploy that image to a Kubernetes cluster in some cloud provider.</li>
<li>The deployment workflow includes Deploy to staging, Canary Deployment, Deploy to production.</li>
</ol>
<h2 id="Details-of-this-hackathon"><a href="#Details-of-this-hackathon" class="headerlink" title="Details of this hackathon"></a>Details of this hackathon</h2><p>Our goal is to start a Spinnaker cluster and create a pipeline that can deploy the Git project to AWS and our own Kubernetes cluster.<br>There’re some contraints for this hackathon, I’m still new to the company so maybe it’s because of my limited information.</p>
<ol>
<li>I don’t have a Kuberntes cluster with API server’s access right, that means I can’t deploy Spinnaker cluster to Kubernetes.</li>
<li>I don’t have a Debian/Ubuntu machine, that means I can’t start Spinnaker on a bare metal with <a href="https://www.spinnaker.io/setup/install/halyard/">Halyard</a>.</li>
<li>The Spinnaker need to be deployed within company’s infrastructure which is not any cloud provider, otherwise it can’t communicate with other infrastructure.</li>
</ol>
<p>And what does Spinnaker need? It needs Halyard to configure the Spinnaker cluster, it will control where Spinnaker cluster is deployed, as we know Spinnaker itself is composed of microservices, hard to deploy on bare metal. Especially for its cloud provider settings, so Spinnaker relies on Halyard heavily, and every time the Spinnaker cluster update and upgrade can be managed safely.</p>
<p>Sadly, Halyard is only used for deploying Spinnaker itself to Kubernetes or  some cloud providers and Debian/Ubuntu single machine. Then according to our constraints above, we lose every chance to use that tool. Maybe it’s time to give up :(</p>
<p>We didn’t give up, choose to install Spinnaker cluster the hardest way. Install Spinnaker cluster on Bare metal machine which is CentOS 7, for running the cluster easier, we use Docker to start each components.</p>
<p><img src="/images/spin-dependencies.webp" alt="Spinnaker microservice dependencies"></p>
<p>My colleague found <code>docker-compose.yml</code> in <a href="https://github.com/spinnaker/spinnaker/tree/master/experimental/docker-compose">Spinnaker</a>, but the latest modification time was 4 years ago. After trying so many times we still couldn’t make it, I tried to give up actually, and also it was far away from quickstart and wasted so much time.</p>
<p>Actually I didn’t give up, I returned home and thought if the Spinnaker cluster can be deployed in Kubernetes, it can be deployed with Docker compose, since they didn’t have any difference.</p>
<p>So I chose the most stupid method, I created a Spinnaker cluster on GCP with far less time and rewrote the <code>docker-compose.yml</code> according to:</p>
<ol>
<li>Check each Kubernetes Pod’s yaml file to get the environment variables, image name, arguments…</li>
<li>Login to the containers to fetch the mounted configuration files like clouddriver.yml, front50.yml, gate.yml… Yes, they’re generated by Halyard where the comment says <code>DONT&#39;T EDIT THIS FILE, IT&#39;S AUTOGENERATED BY...</code>.</li>
</ol>
<p>After another X hours, without ignoring every details, I migrated all the Kubernetes configuration to <code>docker-compose.yml</code>, the second when I ran the <code>docker-compose up -d</code> and every microservice was labeled <code>DONE</code> and <code>http://localhost:9000</code> worked.</p>
<h2 id="Reflection-of-this-hackathon"><a href="#Reflection-of-this-hackathon" class="headerlink" title="Reflection of this hackathon"></a>Reflection of this hackathon</h2><p>Yes, it’s not a happy ending for my first hackathon, our team didn’t reach our goal, there’s some experience for this time.</p>
<p><strong>Gain</strong></p>
<ol>
<li>The hardest way to know how the Spinnaker configuration works, how it deploys.</li>
<li>I felt some joy when the installation was successful :)</li>
<li>Some knowledge about the GCP (first time to use GCP)</li>
</ol>
<p><strong>Improvements next time</strong></p>
<ol>
<li>Team member can be closer, whatever the seat we sit or the communication channel we talked, time is presious, we need check our progress frequently.</li>
<li>Fail fast, although this time I worked out the installation, but it was not a great result, next time we should help the team member to tackle the most important task.</li>
<li>Prepare enough, time is precious, if you want to make it in the Hackathon project, do some preparations, it’s not cheat!</li>
</ol>
<div><h1>Recommended Posts<span style="font-size:0.45em; color:gray">(Driven by<a href="https://github.com/huiwang/hexo-recommended-posts">Hexo Recommended Posts plugin</a>)</span></h1><ul><li><a href="https://songrgg.github.io/operation/install-spinnaker-on-centos/">How to install Spinnaker on CentOS 7</a></li><li><a href="https://songrgg.github.io/architecture/deeper-understanding-to-envoy/">Anatomy of envoy proxy: the architecture of envoy and how it works</a></li><li><a href="https://songrgg.github.io/operation/istio-version-control-on-k8s/">Istio Version Control On Kubernetes</a></li><li><a href="https://songrgg.github.io/operation/nginx-kubernetes-sidecar-for-better-performance/">以Kubernetes sidecar方式部署Nginx: 提供更好的Web性能</a></li></ul></div></div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/kubernetes/">kubernetes</a><a class="link-muted mr-2" rel="tag" href="/tags/sre/">sre</a><a class="link-muted mr-2" rel="tag" href="/tags/cicd/">cicd</a><a class="link-muted mr-2" rel="tag" href="/tags/spinnaker/">spinnaker</a><a class="link-muted mr-2" rel="tag" href="/tags/docker-compose/">docker-compose</a></div><div class="sharethis-inline-share-buttons"></div><script src="//platform-api.sharethis.com/js/sharethis.js#property=5df54e9fee0f770012eb9f87&amp;product=inline-share-buttons&amp;cms=sop" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/operation/host-swagger-documentation-with-yaml-json-files/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">How to host Swagger documentation using yaml/json configuration files?</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/architecture/deeper-understanding-to-envoy/"><span class="level-item">Anatomy of envoy proxy: the architecture of envoy and how it works</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://songrgg.github.io/operation/hackathon-spinnaker/';
            this.page.identifier = 'operation/hackathon-spinnaker/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'srjiang' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><!--!--><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">SongRong&#039;s Experience</a><p class="size-small"><span>&copy; 2020 songrgg</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://songrgg.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>