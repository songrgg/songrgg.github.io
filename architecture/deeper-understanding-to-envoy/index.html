<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Anatomy of envoy proxy: the architecture of envoy and how it works - Blog | Songrgg</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Blog | Songrgg"><meta name="msapplication-TileImage" content="/images/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Blog | Songrgg"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Envoy has become more and more popular, the basic functionality is quite similar to Nginx, working as a high performace Web server, proxy. But Enovy imported a lot of features that was related to SOA"><meta property="og:type" content="article"><meta property="og:title" content="Anatomy of envoy proxy: the architecture of envoy and how it works"><meta property="og:url" content="https://songrgg.github.io/architecture/deeper-understanding-to-envoy/"><meta property="og:site_name" content="Blog | Songrgg"><meta property="og:description" content="Envoy has become more and more popular, the basic functionality is quite similar to Nginx, working as a high performace Web server, proxy. But Enovy imported a lot of features that was related to SOA"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://songrgg.github.io/images/envoy-in-service-mesh.webp"><meta property="article:published_time" content="2019-08-13T22:00:00.000Z"><meta property="article:modified_time" content="2020-09-25T13:03:52.000Z"><meta property="article:author" content="songrgg"><meta property="article:tag" content="envoy"><meta property="article:tag" content="service mesh"><meta property="article:tag" content="architecture"><meta property="article:tag" content="request analysis"><meta property="article:tag" content="microservice"><meta property="article:tag" content="kubernetes"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/images/envoy-in-service-mesh.webp"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://songrgg.github.io/architecture/deeper-understanding-to-envoy/"},"headline":"Anatomy of envoy proxy: the architecture of envoy and how it works","image":["https://songrgg.github.io/images/envoy-in-service-mesh.webp"],"datePublished":"2019-08-13T22:00:00.000Z","dateModified":"2020-09-25T13:03:52.000Z","author":{"@type":"Person","name":"songrgg"},"publisher":{"@type":"Organization","name":"Blog | Songrgg","logo":{"@type":"ImageObject","url":{"text":"SongRong's Experience"}}},"description":"Envoy has become more and more popular, the basic functionality is quite similar to Nginx, working as a high performace Web server, proxy. But Enovy imported a lot of features that was related to SOA"}</script><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><!--!--><script src="https://www.googletagmanager.com/gtag/js?id=UA-74431120-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-74431120-1');</script><!--!--><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Blog | Songrgg" type="application/atom+xml">
</head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">SongRong&#039;s Experience</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/images/envoy-in-service-mesh.webp" alt="Anatomy of envoy proxy: the architecture of envoy and how it works"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-08-13T22:00:00.000Z" title="14/08/2019, 00:00:00">2019-08-14</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-25T13:03:52.000Z" title="25/09/2020, 15:03:52">2020-09-25</time></span><span class="level-item"><a class="link-muted" href="/categories/architecture/">architecture</a></span><span class="level-item">10 minutes read (About 1525 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Anatomy of envoy proxy: the architecture of envoy and how it works</h1><div class="content"><p><a target="_blank" rel="noopener" href="https://www.envoyproxy.io/">Envoy</a> has become more and more popular, the basic functionality is quite similar to <a target="_blank" rel="noopener" href="https://www.nginx.com/">Nginx</a>, working as a high performace Web server, proxy. But Enovy imported a lot of features that was related to <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Service-oriented_architecture">SOA</a> or <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Microservices">Microservice</a> like Service Discovery, Circuit Breaker, Rate limiting and so on. </p>
<p>A lot of developers know the roles envoy plays, and the basic functionality it will implement, but don’t know how it organize the architecture and how we understand its configuration well. For me, it’s not easy to understand envoy’s architecture and its configuration since it has a lot of terminology, but if the developer knew how the user traffic goes, he could understand the design of envoy.</p>
<span id="more"></span>

<h3 id="Envoy-In-Servicemesh"><a href="#Envoy-In-Servicemesh" class="headerlink" title="Envoy In Servicemesh"></a>Envoy In Servicemesh</h3><p>Recently, more and more companies take Service Mesh to solve the communication problem among backend services, it’s a typical use case for envoy to work as a basic component for building a service mesh, envoy plays an important role and one of the service mesh solution <a target="_blank" rel="noopener" href="https://istio.io/">Istio</a> uses Envoy as the core of the networking.</p>
<p><img src="/images/envoy-in-service-mesh.webp" alt="envoy in service mesh"></p>
<p>As pictured, the Envoy is deployed beside every application, this kind of application we call it <code>Sidecar</code>.</p>
<p>Let’s analyze how the user traffic moves.</p>
<ol>
<li>The user hits the website and the browser tries to query an API, the api gateway receives the user request.</li>
<li>The API Gateway redirects the request to the backend server1 (in Kubernetes, it can be a Pod)</li>
<li>The envoy on backend server receives this HTTP request and resolves it to the destination server and forwards the request to the local destination port which APP1 listens at.</li>
<li>The APP1 receives requests, processes the bussiness logic and tries to call a dependent RPC service in APP2, the request first is sent to local envoy.</li>
<li>The local envoy resolves the RPC service APP2’s IP address and port according to the management server and sends the RPC request to APP2 server.</li>
<li>The server where the RPC service located at recevies the request,  to be clear, it’s the envoy receiving the request, after the same logic like step 3.</li>
<li>The APP2 processes the request and returns.</li>
<li>The envoy forwards the response to server1.</li>
<li>There’re two forwards being ignored, envoy(1) to APP1, APP1 to envoy(1). Then the envoy(1) returns the reponse to API gateway.</li>
<li>The API gateway returns to the user.</li>
</ol>
<p>The management server is responsible for telling envoy how to process the requests and where to forward.<br>Service discovery is where applications register themselves.</p>
<h4 id="Ingress-and-Egress"><a href="#Ingress-and-Egress" class="headerlink" title="Ingress and Egress"></a>Ingress and Egress</h4><p>As you can see, there’re two kinds of traffic within a server: ingress and egress.</p>
<ul>
<li>Any traffic sent to server, it’s ingress.</li>
<li>Any traffic sent from server, it’s egress.</li>
</ul>
<p>How to implement this transparently?</p>
<ul>
<li><p>Setup <strong>IPtables</strong> to redirect any traffic to this server to the envoy service first, then envoy redirects the traffic to the real application on this server.</p>
</li>
<li><p>Setup <strong>IPtables</strong> to redirect any traffic from this server to the envoy service first and envoy resolves the destination service using Service Discovery, redirects the request to the destination server.</p>
</li>
</ul>
<p>By intercepting the inbound and outbound traffic, envoy can implement the service discovery, circuit breaker, rate limiting, monitoring transparently, the developers don’t need to care about the details or integrate libraries.</p>
<h3 id="Anatomy-of-envoy-proxy-configuration"><a href="#Anatomy-of-envoy-proxy-configuration" class="headerlink" title="Anatomy of envoy proxy configuration"></a>Anatomy of envoy proxy configuration</h3><p>The first important role of envoy in the service mesh is <strong>proxy</strong>, it receives requests and forwards requests.<br>To see the components that make the proxy work, we can start with a request flow.</p>
<p><img src="/images/envoy-config.webp" alt="How Envoy Configuration works"></p>
<ol>
<li>A request reaches a port on the server which envoy listens at, we call this part <strong>listener</strong>.</li>
<li>Envoy receives the request and tries to process this request according to some rule, the rule is <strong>route</strong>.</li>
<li>The route processes the request based on the request’s metadata and tries to request the specific backend servers, the backend servers are called <strong>cluster</strong>.</li>
<li>The concrete server IP:port behind cluster is called <strong>endpoint</strong>.</li>
</ol>
<p>It’s the main part of envoy components in most of the proxy cases, similar to Nginx, you’re allowed to setup all the configuration by static files.</p>
<p>Here is an example with static configuration, you can see the full file <a target="_blank" rel="noopener" href="https://github.com/envoyproxy/envoy/blob/master/examples/front-proxy/front-envoy.yaml">here</a>.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">static_resources:</span></span><br><span class="line">  <span class="attr">listeners:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">address:</span></span><br><span class="line">      <span class="attr">socket_address:</span></span><br><span class="line">        <span class="attr">address:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">        <span class="attr">port_value:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">filter_chains:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">filters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">envoy.http_connection_manager</span></span><br><span class="line">        <span class="attr">typed_config:</span></span><br><span class="line">          <span class="string">&quot;@type&quot;</span><span class="string">:</span> <span class="string">type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager</span></span><br><span class="line">          <span class="attr">codec_type:</span> <span class="string">auto</span></span><br><span class="line">          <span class="attr">stat_prefix:</span> <span class="string">ingress_http</span></span><br><span class="line">          <span class="attr">route_config:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">local_route</span></span><br><span class="line">            <span class="attr">virtual_hosts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">backend</span></span><br><span class="line">              <span class="attr">domains:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">              <span class="attr">routes:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">match:</span></span><br><span class="line">                  <span class="attr">prefix:</span> <span class="string">&quot;/service/1&quot;</span></span><br><span class="line">                <span class="attr">route:</span></span><br><span class="line">                  <span class="attr">cluster:</span> <span class="string">service1</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">match:</span></span><br><span class="line">                  <span class="attr">prefix:</span> <span class="string">&quot;/service/2&quot;</span></span><br><span class="line">                <span class="attr">route:</span></span><br><span class="line">                  <span class="attr">cluster:</span> <span class="string">service2</span></span><br><span class="line">          <span class="attr">http_filters:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">envoy.router</span></span><br><span class="line">            <span class="attr">typed_config:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">clusters:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">service1</span></span><br><span class="line">    <span class="attr">connect_timeout:</span> <span class="number">0.</span><span class="string">25s</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">strict_dns</span></span><br><span class="line">    <span class="attr">lb_policy:</span> <span class="string">round_robin</span></span><br><span class="line">    <span class="attr">http2_protocol_options:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">load_assignment:</span></span><br><span class="line">      <span class="attr">cluster_name:</span> <span class="string">service1</span></span><br><span class="line">      <span class="attr">endpoints:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">lb_endpoints:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">endpoint:</span></span><br><span class="line">            <span class="attr">address:</span></span><br><span class="line">              <span class="attr">socket_address:</span></span><br><span class="line">                <span class="attr">address:</span> <span class="string">service1</span></span><br><span class="line">                <span class="attr">port_value:</span> <span class="number">80</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">service2</span></span><br><span class="line">    <span class="attr">connect_timeout:</span> <span class="number">0.</span><span class="string">25s</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">strict_dns</span></span><br><span class="line">    <span class="attr">lb_policy:</span> <span class="string">round_robin</span></span><br><span class="line">    <span class="attr">http2_protocol_options:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">load_assignment:</span></span><br><span class="line">      <span class="attr">cluster_name:</span> <span class="string">service2</span></span><br><span class="line">      <span class="attr">endpoints:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">lb_endpoints:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">endpoint:</span></span><br><span class="line">            <span class="attr">address:</span></span><br><span class="line">              <span class="attr">socket_address:</span></span><br><span class="line">                <span class="attr">address:</span> <span class="string">service2</span></span><br><span class="line">                <span class="attr">port_value:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>
<p>Don’t be nervous, you can understand this configuration easily by order:</p>
<ul>
<li>listener<br>It says the envoy listens at 0.0.0.0:80</li>
<li>route<br>It tells how to process request, there’s a route named local_route, a rule matching wildcard domain and forwards the request to <code>service1</code> cluster if the request path’s prefix matches <code>/service/1</code>, else forwards to <code>service2</code> cluster if the request path’s prefix matches <code>service/2</code>.</li>
<li>cluster<br>Finally, the <code>service1</code> cluster memtioned before is resolved to several endpoints, it’s the real address of the server, the address is <code>service1:80</code>.</li>
</ul>
<p>So the basic structure of the configuration is quite straightforward and easy to understand, if you want to manipulate the configuration and don’t know where to start, you can refer to this sample and every data model inside can be found in envoy documentation.</p>
<p>But most importantly, it’s allowed to use <strong>dynamic configuration</strong> which is mostly used in SOA and Microservice, it fits the situations where the service’s endpoints and route rules may change anytime.</p>
<p>For using dynamic resources, envoy supports setting an API server and divides the above components into different APIs or different resources within an API.</p>
<ul>
<li>LDS: listener<br>The listener discovery service (LDS) is an optional API that Envoy will call to dynamically fetch listeners. Envoy will reconcile the API response and add, modify, or remove known listeners depending on what is required.</li>
<li>RDS: route<br>The route discovery service (RDS) API is an optional API that Envoy will call to dynamically fetch route configurations. A route configuration includes both HTTP header modifications, virtual hosts, and the individual route entries contained within each virtual host.</li>
<li>CDS: cluster<br>The cluster discovery service (CDS) is an optional API that Envoy will call to dynamically fetch cluster manager members. Envoy will reconcile the API response and add, modify, or remove known clusters depending on what is required.</li>
<li>EDS: endpoint<br>The endpoint discovery service is a xDS management server based on gRPC or REST-JSON API server used by Envoy to fetch cluster members. The cluster members are called “endpoint” in Envoy terminology. For each cluster, Envoy fetch the endpoints from the discovery service.</li>
</ul>
<p>The concept is equal to the static configuration, you can initialize the configuration by</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">admin:</span></span><br><span class="line">  <span class="attr">access_log_path:</span> <span class="string">/tmp/admin_access.log</span></span><br><span class="line">  <span class="attr">address:</span></span><br><span class="line">    <span class="attr">socket_address:</span> &#123; <span class="attr">address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>, <span class="attr">port_value:</span> <span class="number">9901</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">dynamic_resources:</span></span><br><span class="line">  <span class="attr">lds_config:</span></span><br><span class="line">    <span class="attr">api_config_source:</span></span><br><span class="line">      <span class="attr">api_type:</span> <span class="string">GRPC</span></span><br><span class="line">      <span class="attr">grpc_services:</span></span><br><span class="line">        <span class="attr">envoy_grpc:</span></span><br><span class="line">          <span class="attr">cluster_name:</span> <span class="string">xds_cluster</span></span><br><span class="line">  <span class="attr">cds_config:</span></span><br><span class="line">    <span class="attr">api_config_source:</span></span><br><span class="line">      <span class="attr">api_type:</span> <span class="string">GRPC</span></span><br><span class="line">      <span class="attr">grpc_services:</span></span><br><span class="line">        <span class="attr">envoy_grpc:</span></span><br><span class="line">          <span class="attr">cluster_name:</span> <span class="string">xds_cluster</span></span><br><span class="line"></span><br><span class="line"><span class="attr">static_resources:</span></span><br><span class="line">  <span class="attr">clusters:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">xds_cluster</span></span><br><span class="line">    <span class="attr">connect_timeout:</span> <span class="number">0.</span><span class="string">25s</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">STATIC</span></span><br><span class="line">    <span class="attr">lb_policy:</span> <span class="string">ROUND_ROBIN</span></span><br><span class="line">    <span class="attr">http2_protocol_options:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">upstream_connection_options:</span></span><br><span class="line">      <span class="comment"># configure a TCP keep-alive to detect and reconnect to the admin</span></span><br><span class="line">      <span class="comment"># server in the event of a TCP socket half open connection</span></span><br><span class="line">      <span class="attr">tcp_keepalive:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">load_assignment:</span></span><br><span class="line">      <span class="attr">cluster_name:</span> <span class="string">xds_cluster</span></span><br><span class="line">      <span class="attr">endpoints:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">lb_endpoints:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">endpoint:</span></span><br><span class="line">            <span class="attr">address:</span></span><br><span class="line">              <span class="attr">socket_address:</span></span><br><span class="line">                <span class="attr">address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">                <span class="attr">port_value:</span> <span class="number">5678</span></span><br></pre></td></tr></table></figure>

<p>The only static resource is the xds_cluster which is the management server cluster which provides <strong>a GRPC streaming API</strong> answering the LDS, CDS, EDS, RDS configuration.<br>As you notice, there’re only lds_config and cds_config inside the config file, that’s because rds is included in lds and eds is included in cds.</p>
<p>In Service Mesh architecture, the management server is the most important module, it always connects to a distributed service discovery system which can be <a target="_blank" rel="noopener" href="https://etcd.io/">Etcd</a>, <a target="_blank" rel="noopener" href="https://zookeeper.apache.org/">Zookeeper</a>, <a target="_blank" rel="noopener" href="https://www.consul.io/">Consul</a>, <a target="_blank" rel="noopener" href="https://github.com/Netflix/eureka">Eureka</a> or the Kubernetes(Kubernetes often used Etcd as their service discovery component), and provide some interfaces to manipulate the configuration to implement near-realtime configuration change.</p>
<h2 id="Conclustion"><a href="#Conclustion" class="headerlink" title="Conclustion"></a>Conclustion</h2><p>Understanding how the user traffic flows makes it easier for me to understand the component design of envoy and have a first glimpse of the envoy configuration, then you can start with more features later.</p>
<div><h2>Recommended Posts<span style="font-size:0.45em; color:gray">(Driven by<a target="_blank" rel="noopener" href="https://github.com/huiwang/hexo-recommended-posts">Hexo Recommended Posts plugin</a>)</span></h2><ul><li><a href="https://songrgg.github.io/operation/how-to-alert-for-Pod-Restart-OOMKilled-in-Kubernetes/">How to alert for Pod Restart & OOMKilled in Kubernetes</a></li><li><a href="https://songrgg.github.io/operation/use-traffic-control-simulate-network-chaos/">Use Traffic Control to Simulate Network Chaos in Bare metal & Kubernetes</a></li><li><a href="https://songrgg.github.io/operation/zero-downtime-kubernetes-service-rollout/">Implement zero downtime HTTP service rollout on Kubernetes</a></li><li><a href="https://songrgg.github.io/operation/hackathon-spinnaker/">My first Hackathon: bring Spinnaker to my company</a></li></ul></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/envoy/">envoy</a><a class="link-muted mr-2" rel="tag" href="/tags/service-mesh/">service mesh</a><a class="link-muted mr-2" rel="tag" href="/tags/architecture/">architecture</a><a class="link-muted mr-2" rel="tag" href="/tags/request-analysis/">request analysis</a><a class="link-muted mr-2" rel="tag" href="/tags/microservice/">microservice</a><a class="link-muted mr-2" rel="tag" href="/tags/kubernetes/">kubernetes</a></div><div class="sharethis-inline-share-buttons"></div><script src="//platform-api.sharethis.com/js/sharethis.js#property=5df54e9fee0f770012eb9f87&amp;product=inline-share-buttons&amp;cms=sop" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" href="https://www.buymeacoffee.com/songrgg" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/operation/hackathon-spinnaker/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">My first Hackathon: bring Spinnaker to my company</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/operation/istio-version-control-on-k8s/"><span class="level-item">Istio Version Control On Kubernetes</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://songrgg.github.io/architecture/deeper-understanding-to-envoy/';
            this.page.identifier = 'architecture/deeper-understanding-to-envoy/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'srjiang' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><!--!--><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">SongRong&#039;s Experience</a><p class="is-size-7"><span>&copy; 2022 songrgg</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>